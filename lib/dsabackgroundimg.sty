%!TEX root = example.tex
%!TEX spellcheck = de
% dsabackgroundimg.sty
% Copyright (C) 2017 by David Pfahler
\ProvidesPackage{lib/dsabackgroundimg}[2017/08/02]
\usepackage[pages=all]{background} %background images with different backgrounds for even and odd pages

\usepackage{zref-abspage,zref-lastpage}
\makeatletter
\@ifpackagelater{zref-abspage}{2013/02/09}{%
  \newcommand*{\iffancylastpage}{%
    \ifnum\zref@extractdefault{LastPage}{abspage}{-1}=\value{zabspage}%
      \expandafter\@firstoftwo
    \else
      \expandafter\@secondoftwo
    \fi
  }%
}{%
  \newcommand*{\iffancylastpage}{%
    \ifnum\zref@extractdefault{LastPage}{abspage}{-1}%
        =\numexpr\value{abspage}+1\relax
      \expandafter\@firstoftwo
    \else
      \expandafter\@secondoftwo
    \fi
  }%
}
\makeatother


\newtoggle{bool-a4}
\newtoggle{bool-print}

\DeclareOption{a4}{\toggletrue{bool-a4}}
\DeclareOption{letter}{\togglefalse{bool-a4}}
\DeclareOption{print}{\toggletrue{bool-print}}
\DeclareOption{full}{\togglefalse{bool-print}}

\ExecuteOptions{letter,full}
\ProcessOptions\relax

\iftoggle{bool-a4}{%
	\iftoggle{bool-print}{%
		\newcommand{\oddbackgroundimg}[1]{img/bg-a4-odd-print-#1.jpg}
		\newcommand{\evenbackgroundimg}[1]{img/bg-a4-even-print-#1.jpg}
		}{
		\newcommand{\oddbackgroundimg}[1]{img/bg-a4-odd-#1.jpg}
		\newcommand{\evenbackgroundimg}[1]{img/bg-a4-even-#1.jpg}
		}
	}{%
	\iftoggle{bool-print}{%
		\newcommand{\oddbackgroundimg}[1]{img/bg-letter-odd-print-#1.jpg}
		\newcommand{\evenbackgroundimg}[1]{img/bg-letter-even-print-#1.jpg}
		}{%
		\newcommand{\oddbackgroundimg}[1]{img/bg-letter-odd-#1.jpg}
		\newcommand{\evenbackgroundimg}[1]{img/bg-letter-even-#1.jpg}
		}
	}


\backgroundsetup{
	scale=1,
	opacity=1.0,
	angle=0,
	color=black,
	contents={%
		\ifnum{LastPage}{page}

		\else
			\ifodd\value{page}
				\includegraphics[width=\paperwidth]{\oddbackgroundimg{\intcalcMod{\value{page}}{3}}}
				\else
				\includegraphics[width=\paperwidth]{\evenbackgroundimg{\intcalcMod{\value{page}}{3}}}
			\fi
		\fi
		}
	}


